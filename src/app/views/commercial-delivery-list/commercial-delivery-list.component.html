<c-row>
  <c-col xs="12">
    <c-card class="mb-4">
      <c-card-header>
        <strong>Commercial Deliveries - Customer Mapping</strong>
        <small class="text-muted ms-2">(All deliveries - use Map Customers to assign commercial cylinders)</small>
      </c-card-header>
      <c-card-body>
        <!-- Filter Controls -->
        <div class="row mb-3">
          <div class="col-md-3">
            <label for="fromDate" class="form-label">From Date</label>
            <input id="fromDate" type="date" class="form-control" [(ngModel)]="fromDate" />
          </div>
          <div class="col-md-3">
            <label for="toDate" class="form-label">To Date</label>
            <input id="toDate" type="date" class="form-control" [(ngModel)]="toDate" />
          </div>
          <div class="col-md-6 d-flex align-items-end gap-2">
            <button class="btn btn-primary" (click)="applyFilters()">
              <i class="icon icon-search me-1"></i>Search
            </button>
            <button class="btn btn-secondary" (click)="clearFilters()">Clear</button>
            <small class="text-muted ms-auto align-self-center">{{ paginatedDeliveries.length }} of {{ filteredDeliveries.length }}</small>
          </div>
        </div>

        <div *ngIf="loading()" class="text-center">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>

        <table *ngIf="!loading()" cTable striped hover>
          <thead>
            <tr>
              <th>Date</th>
              <th>Driver</th>
              <th>Vehicle</th>
              <th>Start Time</th>
              <th>Return Time</th>
              <th>Remarks</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let delivery of paginatedDeliveries">
              <td>{{ (delivery.DeliveryDate || delivery.deliveryDate) | date: 'dd/MM/yyyy' }}</td>
              <td>{{ delivery.DriverName || delivery.driverName || '-' }}</td>
              <td>{{ delivery.VehicleNumber || delivery.vehicleNumber || '-' }}</td>
              <td>{{ delivery.StartTime || delivery.startTime || '-' }}</td>
              <td>{{ delivery.ReturnTime || delivery.returnTime || '-' }}</td>
              <td>{{ delivery.Remarks || delivery.remarks || '-' }}</td>
              <td>
                <button
                  *ngIf="permissions.canUpdate"
                  cButton
                  color="primary"
                  size="sm"
                  class="me-2"
                  (click)="mapCustomers(delivery.DeliveryId || delivery.deliveryId || 0)"
                  title="Map Customers">
                  <svg cIcon name="cilPeople" class="me-1"></svg>
                  Map Customers
                </button>
                <button
                  *ngIf="permissions.canUpdate"
                  cButton
                  color="warning"
                  size="sm"
                  variant="outline"
                  (click)="editDelivery(delivery.DeliveryId || delivery.deliveryId || 0)"
                  title="Edit Delivery">
                  <svg cIcon name="cilPencil"></svg>
                </button>
              </td>
            </tr>
            <tr *ngIf="paginatedDeliveries.length === 0">
              <td colspan="7" class="text-center text-muted">
                No deliveries found for selected date range
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Pagination Controls -->
        <div class="d-flex justify-content-between align-items-center mt-3" *ngIf="totalPages > 1 && !loading()">
          <div>
            <button class="btn btn-sm btn-outline-primary me-1" (click)="goToPage(1)" [disabled]="currentPage === 1">
              First
            </button>
            <button class="btn btn-sm btn-outline-primary me-1" (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
              Previous
            </button>
            <span class="mx-2">Page {{ currentPage }} of {{ totalPages }}</span>
            <button class="btn btn-sm btn-outline-primary me-1" (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">
              Next
            </button>
            <button class="btn btn-sm btn-outline-primary" (click)="goToPage(totalPages)" [disabled]="currentPage === totalPages">
              Last
            </button>
          </div>
          <div>
            <select class="form-select form-select-sm" [(ngModel)]="pageSize" (change)="applyFilters()" style="width: auto; display: inline-block;">
              <option [value]="5">5 per page</option>
              <option [value]="10">10 per page</option>
              <option [value]="25">25 per page</option>
              <option [value]="50">50 per page</option>
            </select>
          </div>
        </div>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>
